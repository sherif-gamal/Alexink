<div class="row" dir="rtl">
	<div id="breadcrumb" class="col-md-12">
		<ol class="breadcrumb">
			<li>الصفحة الرئيسية</li>
			<li>عمليات البيع</li>
			<li>الفاتورة</li>
		</ol>
	</div>
</div>
<%=hidden_field_tag "invoice_id", (sprintf '%06d', @invoice.id)%>
<div class="row"  dir="ltr">
	<div class="col-xs-8 col-xs-offset-2" id="invoice">
			<div class="box-content">
				<div>
					<div class="col-xs-5 text-center">
						<br/>
						<div>سجل تجاري رقم: 4274</div>
						<div>بطاقة ضريبية رقم: 954-197-374</div>
						<div>ملف ضريبي رقم: 00-00-250-00123-5</div>
						<br/>
						<strong >No <%=sprintf '%06d', @invoice.id%></strong>
					</div>

					<div class="col-xs-2">
						<%= image_tag "img/logo.png", style:"margin-bottom:20px;"%>
						<strong class="text-center block">فاتورة</strong>
					</div>
					<div class="col-xs-5 pull-right" style="text-align:center;">
							<div><strong>اسكندرية للأحبار المتخصصة والكيماويات</strong></div>
							<div align=center>ش.م.م</div>
							<div>6 شارع عزيز فهمي - سبورتنج</div>
							<div>الإسكندرية - مصر</div>
							<div>ت : 035469692 - 01004814814816</div>
							<div>Email: info@alexinkegypt.net</div>
							<div>تحريراً في : <%= @purchase.created_at.strftime("%Y/%m/%d")%></div>
					</div>
				</div>
				<div class="clearfix"></div>
				<div class="col-xs-12 pull-right text-right" dir="rtl" style="margin-top: 20px;">المطلوب من السادة شركة: <span style="border-bottom: 1px dotted;"><%=@client.name%></span></div>
				<div class="col-xs-12">

					<table border="2" dir="rtl" class="col-xs-12 pull-right">
					  <tr>
					    <th colspan="2" class="text-center">الإجمالي</th>
					    <th colspan="2" class="text-center">سعر الوحدة</th>
					    <th rowspan="2" style="width: 70px" class="text-center">الكمية</th>
					    <th rowspan="2" class="text-center">البيان</th>
					  </tr>
					  <tr>
					    <th style="width: 50px" class="text-center">قرش</th>
					    <th style="width: 60px" class="text-center">جنيه</th>
					    <th style="width: 50px" class="text-center">قرش</th>
					    <th style="width: 60px" class="text-center">جنيه</th>
					  </tr>
					  <%@products.each_with_index do |p, i|%>
						  <tr>
			                <%price_i = @purchase.prices[i].to_f * @purchase.quantities[i].to_f%>
			                <td class="text-center"><%=sprintf '%02d', (price_i - price_i.to_i).to_i%></td>
			                <td class="text-center"><%=price_i.to_i%></td>
			                <td class="text-center"><%=sprintf '%02d', (@purchase.prices[i].to_f - @purchase.prices[i].to_i).to_i%></td>
			                <td class="text-center"><%=@purchase.prices[i].to_i%></td>
			                <td class="text-center"><%=@purchase.quantities[i]%></td>
			                <td class="text-center"><%=p.name%></td>
			              </tr>
					  <%end%>
					  <%(15 - @products.count).times.each do |i|%>
						  <tr>
						  	<td class="text-center">&nbsp</td>
						  	<td class="text-center">&nbsp</td>
						  	<td class="text-center">&nbsp</td>
						  	<td class="text-center">&nbsp</td>
						  	<td></td>
						  	<td></td>
						  </tr>
					  <%end%>
					  <tr>
					  	<td class="text-center"><%=sprintf '%02d', (@purchase.price.to_f - @purchase.price.to_i) * 100%></td>
					  	<td class="text-center"><%=@purchase.price.to_i%></td>
					  	<td class="text-center"></td>
					  	<td class="text-center"></td>
					  	<td class="text-center"></td>
					  	<td class="text-center">الإجمالي</td>
					  </tr>
					  <tr>
					  	<%addition = @purchase.price * 0.1%>
					  	<td class="text-center"><%=sprintf '%02d', (addition - addition.to_i) * 100%></td>
					  	<td class="text-center"><%=addition.to_i%></td>
					  	<td class="text-center"></td>
					  	<td class="text-center"></td>
					  	<td class="text-center"></td>
					  	<td class="text-center">يضاف 10% ض.م</td>
					  </tr>
					  <%subtraction = 0%>
					  <%if @purchase.calc_sub_tax == 1%>
						  <tr>
						  	<%subtraction = @purchase.price * 0.005%>
						  	<td class="text-center"><%=sprintf '%02d', (subtraction - subtraction.to_i) * 100%></td>
						  	<td class="text-center"><%=subtraction.to_i%></td>
						  	<td class="text-center"></td>
						  	<td class="text-center"></td>
						  	<td class="text-center"></td>
						  	<td class="text-center">يخصم 0.5% ض.أ.ص</td>
						  </tr>
					  <%end%>
					  <tr>
					  	<%total = @purchase.price + addition - subtraction%>
					  	<td class="text-center"><%=sprintf '%02d', (total - total.to_i) * 100%></td>
					  	<td class="text-center"><%=total.to_i%></td>
					  	<td class="text-center"></td>
					  	<td class="text-center"></td>
					  	<td class="text-center"></td>
					  	<td class="text-center">الإجمالي بعد الضرائب</td>
					  </tr>

					</table>
					<div class="col-xs-12">
						<div class="col-xs-2 pull-right" dir="rtl">الإجمالي: </div>
						<input type="text" dir="rtl" class="col-xs-10 pull-left" style="border: none;" value="اضغط هنا للتعديل"></input>
					</div>
					<br/>
					<div class="col-xs-12">
						<div class="col-xs-2 pull-right" dir="rtl">حسابات </div>
						<div class="col-xs-2 pull-left">المراجعة</div>
					</div>
					<div class="col-xs-12">
						<div class="col-xs-2 pull-right" dir="rtl" style="border-bottom: 1px dotted;">&nbsp</div>
						<div class="col-xs-2 pull-left" style="border-bottom: 1px dotted;">&nbsp</div>
					</div>
				</div>
				<div class="clearfix"></div>
		</div>
	</div>
</div>
<div class="col-xs-6 col-xs-offset-6">
					<div class="col-xs-4">
						<a href"" class="btn btn-default btn-label-left" id="print"><span><i class="fa fa-floppy-o"></i></span> طباعة</a>
					</div>
				</div>

<%= javascript_include_tag 'js/jspdf.min' %>
<%= javascript_include_tag 'js/html2canvas' %>
<script>
	replaceDigits();
	//require 'jspdf'
	var doc = new jsPDF('p', 'pt', 'a4');
	var specialElementHandlers = {
	    '#editor': function (element, renderer) {
	        return true;
	    }
	};
	$('#print').click(function () {
		html2canvas(document.querySelector("#invoice"), { onrendered: function(canvas) {
			doc.addImage(canvas.toDataURL(), 'JPEG', 0, 0, 595, canvas.height);
    		doc.save('Invoice - ' + $("#invoice_id").val() + '.pdf');
		}});
		// window.location = "/purchases"
	    
	});

</script>